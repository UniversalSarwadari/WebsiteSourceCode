/*!
 * WooCommerce Bulk Variations 2.2.0
 * Copyright 2022 Barn2 Plugins
 */
!function(t,a,e,i,r){"use strict";let l=(()=>{let l=null;const n=()=>{o()},o=()=>{let a=0;t(".wc-bulk-variations-table").each(((e,i)=>{t(i).find(".wcbvp-cell").first().find("select.wcbvp-additional-attribute").each(((e,i)=>{const r=S(t(i));a=Math.max(a,r)}))})),t("select.wcbvp-additional-attribute, .wcbvp-quantity-input").css("min-width",a)},c=()=>{t("input.wcbvp-quantity").trigger("input"),t(".wcbvp-cell").each(((a,e)=>{k(t(e))}))},s=()=>l||t(".wc-bulk-variations-table-wrapper").first(),p=t=>{let a=t.closest(".wc-bulk-variations-table-wrapper");return a=a||s(),a},d=function(){let a=arguments.length>0&&arguments[0]!==r?arguments[0]:null;return a=a||s(),t("form.wcbvp-fast-pool",a).length>0},v=t=>{const a=i.currency_options,e=a.price_format,r=a.decimals||2,l=a.d_separator||".",n=a.t_separator||",",o=a.price_markup||"%s",c=t.toFixed(r).toString().split(".");c[0]=c[0].replace(/\B(?=(\d{3})+(?!\d))/g,n);const s=e.replace(/\%(\d)\$s/g,((t,e)=>({1:a.currency_symbol,2:c.join(l)}[e])));return o.replace("%s",s)},u=a=>{(a=a||t(".wc-bulk-variations-table-wrapper")).each(((a,e)=>{const r=t(e),l=t(".wcbvp-variation-pool",r);t(".wcbvp-cell",r);const n=l.find(".wcbvp-quantity").toArray().reduce(((t,a)=>({quantity:t.quantity+Number(a.value),total:t.total+Number(a.dataset.price)*Number(a.value)})),{quantity:0,total:0});t(".wcbvp_total_items",r).html(n.quantity),t(".wcbvp_total_price",r).html(v(n.total)),t('label[role="status"]',r).html(`${n.quantity} ${1!==n.quantity?i.i18n_item_plural:i.i18n_item_singular}. ${i.i18n_your_total.replace("%s",v(n.total))}`).trigger("focus"),t(".wcbvp_total_quantity",r).html(n.quantity),t(".single_add_to_cart_button",r).toggleClass("disabled wc-variation-selection-needed",0===n.quantity).prop("disabled",0===n.quantity)})),t(e).trigger("wc_bulk_variations_table_recalculate",[a])},b=()=>{const a=new ResizeObserver((t=>{for(let a of t)a.contentBoxSize[0]&&a.contentBoxSize[0].inlineSize===a.contentRect.width&&n()}));t(".wc-bulk-variations-table").each(((t,e)=>{a.observe(e)}))},m=e=>{const i=t(e.currentTarget);if(i.closest(".wc-quick-view-modal").length||a.wc_fast_cart_params&&-1!==wc_fast_cart_params.selectors.cartBtn.indexOf(".wc-bulk-variations-table-wrapper form button.single_add_to_cart_button"))return!0;i.submit()},w=a=>{const i=a.closest(".wc-bulk-variations-table-wrapper"),l=t(".wcbvp-variation-pool",i),n=a.closest(".wcbvp-cell"),o=N(n);if(!o||!o.variation)return!0;const c=o.variation.variation_id;let s=o.variation.display_price;const p=t(e).triggerHandler("wbvCell.update",[{},o.variation,i]);r!==p&&r!==p.price&&(s=p.price);let v,b=Number(n.find(".wcbvp-quantity-field input").val()),m=l.find(`div[data-product_id="${c}"]`);if(0===b)m.remove();else{if(m.length)v=m.find("input");else{d()&&(t(".wcbvp-variation-pool-item").removeClass("selected"),t(".wcbvp-form-variation").removeClass("selected")),m=t("<div>",{id:`pool_item_${c}`,class:"wcbvp-variation-pool-item"}).attr("data-product_id",c).addClass("selected");for(const[t,a]of Object.entries(o.attributes.object))m.attr(`data-${t}`,a.name);v=t("<input>",{type:"hidden",name:`quantity[${c}]`,class:"wcbvp-quantity"}),l.append(m)}v.val(b).attr("data-price",s),m.empty().append(v,d()?t("<span>",{class:"label",title:`${b}x ${o.attributes.label}`}).html(`${b}&times; ${o.attributes.label}`):null,d()?t("<span>",{class:"action-delete"}):null)}u()},_=function(){let a=arguments.length>0&&arguments[0]!==r?arguments[0]:null,e=arguments.length>1&&arguments[1]!==r&&arguments[1];a=a||s(),a.each(((a,i)=>{const r=t(i);if(!d()&&!e)return!0;t('.wcbvp-cell .wcbvp-quantity-field input[type="number"]',r).each(((a,i)=>{const l=t(i),n=t("form.wcbvp-cart",r),o=l.closest(".wcbvp-cell"),c=o.data("variation_ids")&&o.data("variation_ids").toString().split(",").length>1,s=n.hasClass("wcbvp-multivariation-cells"),p=n.hasClass("wcbvp-compact-grid-mode");if((e||c||s)&&k(o),t(".price",o).html(t(".price",o).attr("data-default")),0===n.length||"0"===t(i).prop("max"))return!0;if(l.prop("disabled",c||s||p),e||s||p){const t=N(o);if(t&&!c){const a=Number(t.variation.input_value)||0;l.prop("max",t.variation.max_qty),l.val(a)}else l.attr("min","").prop("max",""),l.val(0)}})),t(".wcbvp-cell select.wcbvp-additional-attribute",r).val(""),t(".wcbvp-header select.wcbvp-additional-attribute",r).val(""),d()&&(t(".wcbvp-variation-pool-item",r).removeClass("selected layer-selected"),t(".wcbvp-form-variation",r).removeClass("selected")),e&&(t(".wcbvp-variation-pool-item",r).remove(),c())})),u(a)},g=a=>{let e=t(".wc-bulk-variations-table-wrapper");a&&(e=t(a.target).find(".wc-bulk-variations-table-wrapper")),_(e,!0)},f=a=>{const e=t(a.currentTarget),i=p(e),r=e.closest(".wcbvp-cell"),l=t("form.wcbvp-cart",i);t(".wcbvp-cell",i).not(r).find(":input").each(((a,e)=>{l.hasClass("wcbvp-compact-grid-mode")||("SELECT"===e.tagName?l.hasClass("wcbvp-multivariation-cells")&&t(e).val(""):l.hasClass("wcbvp-multivariation-cells")&&t(e).val(0))})),d()&&(t(".wcbvp-variation-pool-item").removeClass("selected"),t(".wcbvp-form-variation").removeClass("selected"),t(".wcbvp-form-variation",r).addClass("selected")),r.attr("data-variation_ids")&&1===r.attr("data-variation_ids").split(",").length&&i.find(`#pool_item_${r.attr("data-variation_ids")}`).addClass("selected"),e.hasClass("wcbvp-quantity")&&e.trigger("select")},h=a=>{const e=t(a.currentTarget),i=e.closest(".wcbvp-cell"),r=N(i);if(r){const l=Number(r.variation.min_qty)||1,n=Number(r.variation.max_qty)||-1,o=Number(e.val());n>-1&&o>n&&(a.preventDefault(),e.val(n)),o>0&&o<l&&(a.preventDefault(),e.val(l));const c=e.data("individual"),s=e.val();c&&s>0&&(t(".wcbvp-quantity",p(i)).not(e.get(0)).val(0),s>1&&e.val(1)),w(e)}u(e.closest(".wc-bulk-variations-table-wrapper"))},y=a=>{const e=t("form.wcbvp-cart",p(a)).data("product_variations"),i=a.attr("data-variation_ids");return e&&i?e.filter((t=>i.split(",").map((t=>Number(t))).includes(t.variation_id))):[]},k=a=>{let e=a;a.hasClass("wcbvp-additional-attribute")&&(e=a.closest(".wcbvp-cell"));const r=t("form.wcbvp-cart",p(e)),l=i.hide_out_of_stock_items,n=i.hide_discontinued;if(r){const i=y(e);t("select",e).not(a).each(((e,r)=>{const o=t(r);let c=i;a.hasClass("wcbvp-additional-attribute")&&a.val()&&(c=c.filter((t=>{const e=a.data("attribute_name");return t.attributes[e]&&a.val()===t.attributes[e]}))),t("option",o).each(((a,e)=>{const i=t(e);if(!i.val())return!0;const r=c.filter((t=>t.attributes[o.data("attribute_name")]&&i.val()===t.attributes[o.data("attribute_name")])),s=0===r.length,p=0===r.filter((t=>t.is_purchasable)).length,d=0===r.filter((t=>t.is_in_stock)).length&&l,v=0===r.filter((t=>t.is_in_stock&&!t.is_purchasable&&t.availability_html.includes("discontinued"))).length||n,u=s||p&&v||d;i.prop("hidden",u),o.val()===i.val()&&u&&o.val("")})),o.prop("disabled",t("option",o).length===t("option:hidden",o))}))}},q=a=>{const e=t(a.currentTarget),i=e.closest(".wcbvp-cell"),r=p(i);C(i)||k(e),u(r)},C=function(a){let l=!(arguments.length>1&&arguments[1]!==r)||arguments[1];const n=p(a);t(".stock",a).hide(),d()&&(t(".wcbvp-cell",n).not(a).find("select").val(""),t(".wcbvp-cell",n).not(a).find("input.wcbvp-quantity-input").val(0),t(".wcbvp-form-variation").removeClass("selected"),a.find(".wcbvp-form-variation").addClass("selected"));const o=N(a),c=t(".wcbvp-variation-pool",n),s=t("input.wcbvp-quantity",a);let u=0,b="";if(s.prop("disabled",!0),d()||t(".wcbvp-variation-pool-item",c).filter(((e,i)=>a.attr("data-variation_ids").split(",").includes(t(i).data("product_id").toString()))).remove(),o){let p={isInStock:o.variation.is_in_stock,isPurchasable:o.variation.is_purchasable,price:o.variation.display_price,stock:o.variation.availability_html};const m=t(e).triggerHandler("wbvCell.update",[p,o.variation,n]);r!==m&&(p=m);const _=p.isInStock,g=p.isPurchasable;if(t(">*",a).toggle(g),!g)return!0;if(s.prop("disabled",!_||!g),_){const t=s.val()||Number(o.variation.input_value)||0;if(s.attr("min",o.variation.min_qty).attr("max",o.variation.max_qty).val(t).trigger("select"),l&&s.trigger("focus"),d()){s.val(0);const t=c.find(`.wcbvp-variation-pool-item[data-product_id="${o.variation.variation_id}"]`);c.find(".wcbvp-variation-pool-item").removeClass("selected"),t.length&&(s.val(t.find(".wcbvp-quantity").val()).trigger("select"),t.addClass("selected"))}else s.val()>0&&w(s);(i.show_stock||i.show_discontinued)&&(b=p.stock)}else b=p.stock;u=v(p.price),b=p.stock}else s.val(0).trigger("input"),u=x(a);return t(".price",a).html(u),t(".stock",a).html(b).show(),!1!==o},x=a=>{const i=y(a),l=a.closest(".wc-bulk-variations-table-wrapper");let n="display_price";const o=t(e).triggerHandler("wbvCell.pricerange",[n,l]);r!==o&&(n=o);let c=i.reduce(((t,a)=>({min:Math.min(t.min,a[n]),max:Math.max(t.max,a[n])})),{min:1/0,max:0});return c.min===c.max?v(c.min):0===c.max?"":`${v(c.min)} â€“ ${v(c.max)}`},N=a=>{const e=[a.data("h_label")],i=p(a);let r,l;a.attr("data-v_label")&&e.push(a.attr("data-v_label"));let n=t("select",a);t("form.wcbvp-cart",i).hasClass("wcbvp-compact-grid-mode")&&(n=t(".wcbvp-header select",i));const o=y(a);if(!o.length)return!1;if(n.length>0){if(n.toArray().filter((t=>!t.value)).length)return!1;const a=n.toArray().map((a=>({[a.name]:{name:a.value,label:t(a).find(`option[value="${a.value}"]`).text()}}))).reduce(((t,a)=>({...t,...a})),{});if(r=o.find((t=>Object.entries(a).filter((a=>a[0]in t.attributes&&t.attributes[a[0]]===a[1].name)).length===n.length)),!r)return!1;let i=e.concat(Object.values(a).map((t=>t.label))).join(", ");l={object:a,label:i}}else r=o[0],l={object:{},label:e.join(", ")};return{attributes:l,variation:r}},$=a=>0===t(a.target).closest(".wc-bulk-variations-table-wrapper").length||((a=>{const e=p(a.target);a.stopPropagation(),e.length&&(d()&&t(".wc-bulk-variations-table",e).attr("id")!==t(".wc-bulk-variations-table",l).attr("id")&&_(),l=e)})(a),t(a.target).closest(".wcbvp-form-variation, .wcbvp-variation-pool-item, .wcbvp-compact-grid-mode .wcbvp-row-header.wcbvp-col-header").length>0||void _()),S=a=>{const i=getComputedStyle(a.get(0)),r=a.parent().get(0),l=a.clone();l.find("option:not(:first-child)").remove();const{font:n,border:o,padding:c,margin:s,marginRight:p,marginLeft:d,paddingLeft:v,paddingRight:u}=i;l.css({font:n,border:o,padding:c,margin:s}),t(e.body).append(l);const b=l.get(0).offsetWidth;l.remove();const m=Number(d.replace("px",""))+Number(p.replace("px","")),w=Number(v.replace("px",""))+Number(u.replace("px",""));return Math.min(b,r.offsetWidth-m-w)},j=a=>{const e=t(a.target),i=t("form.wcbvp-cart",p(e));if(i){const t=e.data("variation"),a=i.data("product_variations").filter((a=>a.variation_id===t&&a.image));a.length>0&&i.wc_variations_image_update(a[0])}},P=e=>{if("undefined"==typeof PhotoSwipe||"undefined"==typeof PhotoSwipeUI_Default)return!0;e.preventDefault();var i=t(".pswp")[0],r=t(e.target).closest(".woocommerce-product-gallery__image"),l=[];i.classList.add("wbv-gallery"),r.length>0&&r.each((function(a,e){var i=t(e).find("img"),r={src:i.attr("data-large_image"),w:i.attr("data-large_image_width"),h:i.attr("data-large_image_height"),title:i.attr("data-caption")&&i.attr("data-caption").length?i.attr("data-caption"):i.attr("title")};l.push(r)}));var n=new PhotoSwipe(i,PhotoSwipeUI_Default,l,{index:0,shareEl:!1,closeOnScroll:!1,history:!1,hideAnimationDuration:0,showAnimationDuration:0});n.init(),n.listen("close",(function(){a.dontCloseQVP=!0}))};return{initialize:()=>{t(e.body).on("click",$).on("submit",".wc-bulk-variations-table-wrapper form :input",(t=>t.preventDefault())).on("click",".wc-bulk-variations-table-wrapper form button.single_add_to_cart_button",m).on("focus",".wcbvp-form-variation :input",f).on("change",".wcbvp-cell select.wcbvp-additional-attribute",q).on("input",".wcbvp-quantity-field input",h).on("click",".wc-bulk-variations-table .wcbvp-header img, .wc-bulk-variations-table .wcbvp-col-image img",j).on("click",".wc-bulk-variations-table .woocommerce-product-gallery__image a",P).on("quick_view_pro:added_to_cart",g).on("quick_view_pro:open_complete",c).on("updated_checkout",g),b(),n(),_()},recalculate:u,getPool:a=>{a=a||t(".wc-bulk-variations-table-wrapper");const e={};return a.each(((a,i)=>{const r=t(i),l=[];let n=t(".wcbvp-total-wrapper",r).attr("id")||"",o=0;n=n?n.replace("wcbvp_wrapper_wbv_",""):o++,t(".wcbvp-variation-pool-item",r).toArray().forEach((t=>{l.push({product_id:Number(t.dataset.product_id),quantity:Number(t.children[0].value)})})),e[n]=l})),e},reset:_,clear:g,getSelection:N,wcFormatPrice:v,resetTableInfo:a=>{t(".wcbvp-cell",a).each(((a,e)=>{C(t(e),!1)})),u(a)}}})();a.WCBulkVariations=l,t((()=>{l.initialize()}))}(jQuery,window,document,wc_bulk_variations_params);